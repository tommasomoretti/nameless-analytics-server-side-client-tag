___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "CLIENT",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Nameless Analytics | SS | Client tag",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfQAAAH0CAYAAADL1t+KAAAAAXNSR0IArs4c6QAAAHhlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAAAkAAAAAQAAACQAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAAfSgAwAEAAAAAQAAAfQAAAAANGC8/AAAAAlwSFlzAAAFiQAABYkBbWid+gAALlxJREFUeAHt3QmUXWd9GPDRLJIsb2jQNtLYKCCW4IQ1AZqmtCElkNBS4CQpnHCAOiHHgcMWA8Z2vG9gCCkQQkgCNFAKJJgUOC00hHBamgJtIWURgSDwIGmk0WILL7Kl0cyo/2sbaSzNvHnz3n333ft9vzlHR2/u8n3//+970v99d3sDA34IECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBQkcCKivrRDYFSBTZv3vzl48ePP7XURktobMWKFev37NlzsISm7mtibGzs38eLny+rvbLaCfuvR66PL6u9prYTDm+empr6eFPjTyXujRs3PmNwcPDmVPLpNI/hTne0HwEClQg8Mnp5ciU9LaOT4oNLbL45/mT9f0g4XBsGn4g/c/HHT58Eopg/JLqu3b+TqjkGq+5QfwQIJCFwfsxOv5hEJt0l8ZObNm16SXdN2JtAOQIKejmOWiGQnUDMTi+IpKezS/yUhMPh0lg0dMpivxKoXEBBr5xchwSSEdgQmXwpmWw6T+RRca3DhZ3vbk8C5Qgo6OU4aoVArgLFhXFHck1+Xt5vitdZX08wz8LLPgko6H2C1y2BRASKi5G+mkgu3aTx8DiX/vJuGrAvgW4FFPRuBe1PgMATg+Ce3BniXPolYTCSu4P8+yegoPfPXs8EUhFYE1e8fyOVZLrI42HxfISLutjfrgS6ElDQu+KzMwEChUDMTp8Uf92du0Z8sHnjtm3bVuXuIP/+CCjo/XHXK4HUBFZGUf9Oakl1kM/44cOHX9nBfnYh0LWAgt41oQYIECgEYnb6xPhzZ+4a8cHm9Vu3bl2du4P8qxdQ0Ks31yOBVAWG4hGct6aaXLt5xYeasenp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ividAAECBDoWWLNmzZ/EzsWXt/ipWEBBrxhcdwQIEEhZYMeOHcXXql6fco51zU1Br+vIiIsAAQINFdi7d+8HIvRbGxp+Y8NW0Bs7dAInQIBAbQWOxRXv19Y2ukQDU9ATHVhpESBAoJ8C8cUtH4r+v9fPGHLrW0HPbcTlS4AAgWoEZuMWtqur6UovhYCC7n1AgAABAj0R2LNnz0ej4W/3pHGNniYwfNqSdBd8Oz4tnlun9OIc00zZ8USO3402j5TdbrftxZWvc922MX//sNsRua6Zv6wOr1euXFnqmEaOE5HXN+uQ2/wY4isziyuZ/RBYSmAu/q1eFe/jv1xqQ+u7F1jRfRNaIECAAAECiwqsGBsbuyzWnrHoFlYQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAQLME/j+dHohhvivoygAAAABJRU5ErkJggg\u003d\u003d"
  },
  "description": "A highly customizable GTM custom template designed to claim requests from Nameless Analytics Client-side tracker tag and Nameless Analytics Streaming protocol.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "LABEL",
    "name": "event_data_title",
    "displayName": "\u003cb\u003eEvent data\u003c/br\u003e"
  },
  {
    "type": "GROUP",
    "name": "user_data",
    "displayName": "User data",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "override_user_id",
        "checkboxText": "Add/override User ID",
        "simpleValueType": true,
        "displayName": "User parameters",
        "help": "Add or override User ID to the request in user_data.user_id.",
        "defaultValue": false,
        "alwaysInSummary": true,
        "subParams": [
          {
            "type": "TEXT",
            "name": "user_id",
            "displayName": "User ID",
            "simpleValueType": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "alwaysInSummary": true,
            "valueHint": "(not set)",
            "enablingConditions": [
              {
                "paramName": "override_user_id",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "add_user_parameters",
        "checkboxText": "Add/override user level parameters",
        "simpleValueType": true,
        "subParams": [
          {
            "type": "SIMPLE_TABLE",
            "name": "user_params_to_add",
            "displayName": "User parameters",
            "simpleTableColumns": [
              {
                "defaultValue": "",
                "displayName": "Param name",
                "name": "param_name",
                "type": "TEXT",
                "isUnique": true,
                "valueHint": "(not set)",
                "valueValidators": [
                  {
                    "type": "NON_EMPTY"
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_date$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override user_date parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_channel_grouping$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override user_channel_grouping parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_source$).*"
                    ],
                    "enablingConditions": [],
                    "errorMessage": "Can\u0027t add/override user_source parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_tld_source$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override user_tld_source parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_campaign$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override user_campaign parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_campaign_id$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override user_channel_grouping parameter.",
                    "enablingConditions": []
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_campaign_content$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override user_campaign_content parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_campaign_term$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override user_campaign_term parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_device_type$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override user_device_type parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_country$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override user_country parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_language$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override user_language parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_first_session_timestamp$).*"
                    ],
                    "errorMessage": "Can\u0027t add user_first_session_timestamp parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_last_session_timestamp$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override user_last_session_timestamp parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_id$).*"
                    ],
                    "errorMessage": "Can\u0027t add user_id parameter. Add the user ID in the field above."
                  }
                ]
              },
              {
                "defaultValue": "",
                "displayName": "Param value",
                "name": "param_value",
                "type": "TEXT",
                "valueHint": "(not set)",
                "valueValidators": [
                  {
                    "type": "NON_EMPTY"
                  }
                ]
              }
            ],
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "alwaysInSummary": true,
            "enablingConditions": [
              {
                "paramName": "add_user_parameters",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          }
        ],
        "alwaysInSummary": true,
        "help": "Add or override user parameters to the request in user_data. If a parameter has the same name, it will be overridden.\n\u003c/br\u003e\u003c/br\u003e\nReserved user parameters: \u003c/br\u003e \n• user_date \u003c/br\u003e \n• user_id \u003c/br\u003e \n• user_channel_grouping \u003c/br\u003e \n• user_source \u003c/br\u003e \n• user_tld_source \u003c/br\u003e \n• user_campaign \u003c/br\u003e \n• user_campaign_id \u003c/br\u003e \n• user_campaign_content \u003c/br\u003e \n• user_campaign_term \u003c/br\u003e \n• user_device_type \u003c/br\u003e \n• user_country \u003c/br\u003e \n• user_language \u003c/br\u003e \n• user_first_session_timestamp \u003c/br\u003e\n• user_last_session_timestamp \u003c/br\u003e",
        "defaultValue": false,
        "displayName": ""
      },
      {
        "type": "CHECKBOX",
        "name": "remove_user_parameters",
        "checkboxText": "Remove user level parameters",
        "simpleValueType": true,
        "displayName": "",
        "help": "Remove user parameters from the request in user_data. If a parameter has the same name, it will be overridden.\n\u003c/br\u003e\u003c/br\u003e\nReserved user parameters: \u003c/br\u003e \n• user_date \u003c/br\u003e \n• user_id \u003c/br\u003e \n• user_channel_grouping \u003c/br\u003e \n• user_source \u003c/br\u003e \n• user_tld_source \u003c/br\u003e \n• user_campaign \u003c/br\u003e \n• user_campaign_id \u003c/br\u003e \n• user_campaign_content \u003c/br\u003e \n• user_campaign_term \u003c/br\u003e \n• user_device_type \u003c/br\u003e \n• user_country \u003c/br\u003e \n• user_language \u003c/br\u003e \n• user_first_session_timestamp \u003c/br\u003e\n• user_last_session_timestamp \u003c/br\u003e",
        "defaultValue": false,
        "alwaysInSummary": true,
        "subParams": [
          {
            "type": "SIMPLE_TABLE",
            "name": "user_params_to_remove",
            "displayName": "User parameters",
            "simpleTableColumns": [
              {
                "defaultValue": "",
                "displayName": "Param name",
                "name": "param_name",
                "type": "TEXT",
                "isUnique": true,
                "valueHint": "(not set)",
                "valueValidators": [
                  {
                    "type": "NON_EMPTY"
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_date$).*"
                    ],
                    "errorMessage": "Can\u0027t remove user_date parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_channel_grouping$).*"
                    ],
                    "errorMessage": "Can\u0027t remove user_channel_grouping parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_source$).*"
                    ],
                    "errorMessage": "Can\u0027t remove user_source parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_tld_source$).*"
                    ],
                    "errorMessage": "Can\u0027t remove user_tld_source parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_campaign$).*"
                    ],
                    "errorMessage": "Can\u0027t remove user_campaign parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_campaign_id$).*"
                    ],
                    "errorMessage": "Can\u0027t remove user_campaign_id parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_campaign_content$).*"
                    ],
                    "errorMessage": "Can\u0027t remove user_campaign_content parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_campaign_term$).*"
                    ],
                    "errorMessage": "Can\u0027t remove user_campaign_term parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_device_type$).*"
                    ],
                    "errorMessage": "Can\u0027t remove user_device_type parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_country$).*"
                    ],
                    "errorMessage": "Can\u0027t remove user_country parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_language$).*"
                    ],
                    "errorMessage": "Can\u0027t remove user_language parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_first_session_timestamp$).*"
                    ],
                    "errorMessage": "Can\u0027t remove user_first_session_timestamp parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_last_session_timestamp$).*"
                    ],
                    "errorMessage": "Can\u0027t remove user_last_session_timestamp parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_id$).*"
                    ],
                    "errorMessage": "Can\u0027t remove user_id parameter. Override the user ID in the field above."
                  }
                ]
              }
            ],
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "alwaysInSummary": true,
            "enablingConditions": [
              {
                "paramName": "remove_user_parameters",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "session_data",
    "displayName": "Session data",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "add_session_parameters",
        "checkboxText": "Add/override session level parameters",
        "simpleValueType": true,
        "subParams": [
          {
            "type": "SIMPLE_TABLE",
            "name": "session_params_to_add",
            "displayName": "Session parameters",
            "simpleTableColumns": [
              {
                "defaultValue": "",
                "displayName": "Param name",
                "name": "param_name",
                "type": "TEXT",
                "isUnique": true,
                "valueHint": "(not set)",
                "valueValidators": [
                  {
                    "type": "NON_EMPTY"
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_date$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override session_date parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_number$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override session_number parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!cross_domain_session$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override cross_domain_session parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_channel_grouping$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override session_channel_grouping parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_source$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override session_source parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_tld_source$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override session_tld_source parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_campaign$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override session_campaign parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_campaign_id$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override session_campaign_id parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_campaign_content$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override session_campaign_content parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_campaign_term$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override session_campaign_term parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_device_type$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override session_device_type parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_country$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override session_country parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_language$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override session_language parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_hostname$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override session_hostname parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_browser_name$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override session_browser_name parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_landing_page_category$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override session_landing_page_category parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_landing_page_location$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override session_landing_page_location parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_landing_page_title$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override session_landing_page_title parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_exit_page_category$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override session_exit_page_category parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_exit_page_location$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override session_exit_page_location parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_exit_page_title$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override session_exit_page_title parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_start_timestamp$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override session_start_timestamp parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_end_timestamp$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override session_end_timestamp parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_id$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override session_id parameter."
                  }
                ]
              },
              {
                "defaultValue": "",
                "displayName": "Param value",
                "name": "param_value",
                "type": "TEXT",
                "valueHint": "(not set)",
                "valueValidators": [
                  {
                    "type": "NON_EMPTY"
                  }
                ]
              }
            ],
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "alwaysInSummary": true,
            "enablingConditions": [
              {
                "paramName": "add_session_parameters",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          }
        ],
        "alwaysInSummary": true,
        "help": "Add or override session parameters to the request in session_data. If a parameter has the same name, it will be overridden.\n\u003c/br\u003e\u003c/br\u003e\nReserved session parameters: \u003c/br\u003e\n• session_date \u003c/br\u003e \n• session_id \u003c/br\u003e\n• session_number \u003c/br\u003e \n• cross_domain_session \u003c/br\u003e \n• session_channel_grouping \u003c/br\u003e \n• session_source \u003c/br\u003e \n• session_tld_source \u003c/br\u003e \n• session_campaign \u003c/br\u003e \n• session_campaign_id \u003c/br\u003e \n• session_campaign_content \u003c/br\u003e \n• session_campaign_term \u003c/br\u003e \n• session_device_type \u003c/br\u003e \n• session_country \u003c/br\u003e \n• session_language \u003c/br\u003e \n• session_hostname \u003c/br\u003e \n• session_browser_name \u003c/br\u003e \n• session_landing_page_category \u003c/br\u003e \n• session_landing_page_location \u003c/br\u003e \n• session_landing_page_title \u003c/br\u003e \n• session_exit_page_category \u003c/br\u003e \n• session_exit_page_location \u003c/br\u003e \n• session_exit_page_title \u003c/br\u003e \n• session_start_timestamp \u003c/br\u003e \n• session_end_timestamp \u003c/br\u003e",
        "defaultValue": false,
        "displayName": "Session parameters"
      },
      {
        "type": "CHECKBOX",
        "name": "remove_session_parameters",
        "checkboxText": "Remove session level parameters",
        "simpleValueType": true,
        "subParams": [
          {
            "type": "SIMPLE_TABLE",
            "name": "session_params_to_remove",
            "displayName": "Session parameters",
            "simpleTableColumns": [
              {
                "defaultValue": "",
                "displayName": "Param name",
                "name": "param_name",
                "type": "TEXT",
                "isUnique": true,
                "valueHint": "(not set)",
                "valueValidators": [
                  {
                    "type": "NON_EMPTY"
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_date$).*"
                    ],
                    "errorMessage": "Can\u0027t remove session_date parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_number$).*"
                    ],
                    "errorMessage": "Can\u0027t remove session_number parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!cross_domain_session$).*"
                    ],
                    "errorMessage": "Can\u0027t remove cross_domain_session parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_channel_grouping$).*"
                    ],
                    "errorMessage": "Can\u0027t remove session_channel_grouping parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_source$).*"
                    ],
                    "errorMessage": "Can\u0027t remove session_source parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_tld_source$).*"
                    ],
                    "errorMessage": "Can\u0027t remove session_tld_source parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_campaign$).*"
                    ],
                    "errorMessage": "Can\u0027t remove session_campaign parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_campaign_id$).*"
                    ],
                    "errorMessage": "Can\u0027t remove session_campaign_id parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_campaign_content$).*"
                    ],
                    "errorMessage": "Can\u0027t remove session_campaign_content parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_campaign_term$).*"
                    ],
                    "errorMessage": "Can\u0027t remove session_campaign_term parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_device_type$).*"
                    ],
                    "errorMessage": "Can\u0027t remove session_device_type parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_country$).*"
                    ],
                    "errorMessage": "Can\u0027t remove session_country parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_language$).*"
                    ],
                    "errorMessage": "Can\u0027t remove session_language parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_hostname$).*"
                    ],
                    "errorMessage": "Can\u0027t remove session_hostname parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_browser_name$).*"
                    ],
                    "errorMessage": "Can\u0027t remove session_browser_name parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_landing_page_category$).*"
                    ],
                    "errorMessage": "Can\u0027t remove session_landing_page_category parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_landing_page_location$).*"
                    ],
                    "errorMessage": "Can\u0027t remove session_landing_page_location parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_landing_page_title$).*"
                    ],
                    "errorMessage": "Can\u0027t remove session_landing_page_title parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_exit_page_category$).*"
                    ],
                    "errorMessage": "Can\u0027t remove session_exit_page_category parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_exit_page_location$).*"
                    ],
                    "errorMessage": "Can\u0027t remove session_exit_page_location parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_exit_page_title$).*"
                    ],
                    "errorMessage": "Can\u0027t remove session_exit_page_title parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_start_timestamp$).*"
                    ],
                    "errorMessage": "Can\u0027t remove session_start_timestamp parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_end_timestamp$).*"
                    ],
                    "errorMessage": "Can\u0027t remove session_end_timestamp parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!session_id$).*"
                    ],
                    "errorMessage": "Can\u0027t remove session_id parameter."
                  }
                ]
              }
            ],
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "alwaysInSummary": true,
            "enablingConditions": [
              {
                "paramName": "remove_session_parameters",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          }
        ],
        "alwaysInSummary": true,
        "help": "Remove session parameters from the request in session_data. If a parameter has the same name, it will be overridden.\n\u003c/br\u003e\u003c/br\u003e\nReserved session parameters: \u003c/br\u003e\n• session_date \u003c/br\u003e \n• session_id \u003c/br\u003e\n• session_number \u003c/br\u003e \n• cross_domain_session \u003c/br\u003e \n• session_channel_grouping \u003c/br\u003e \n• session_source \u003c/br\u003e \n• session_tld_source \u003c/br\u003e \n• session_campaign \u003c/br\u003e \n• session_campaign_id \u003c/br\u003e \n• session_campaign_content \u003c/br\u003e \n• session_campaign_term \u003c/br\u003e \n• session_device_type \u003c/br\u003e \n• session_country \u003c/br\u003e \n• session_language \u003c/br\u003e \n• session_hostname \u003c/br\u003e \n• session_browser_name \u003c/br\u003e \n• session_landing_page_category \u003c/br\u003e \n• session_landing_page_location \u003c/br\u003e \n• session_landing_page_title \u003c/br\u003e \n• session_exit_page_category \u003c/br\u003e \n• session_exit_page_location \u003c/br\u003e \n• session_exit_page_title \u003c/br\u003e \n• session_start_timestamp \u003c/br\u003e \n• session_end_timestamp \u003c/br\u003e",
        "defaultValue": false,
        "displayName": ""
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "event_data",
    "displayName": "Event data",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "add_event_parameters",
        "checkboxText": "Add/override event level parameters",
        "simpleValueType": true,
        "subParams": [
          {
            "type": "SIMPLE_TABLE",
            "name": "event_params_to_add",
            "displayName": "Event parameters",
            "simpleTableColumns": [
              {
                "defaultValue": "",
                "displayName": "Param name",
                "name": "param_name",
                "type": "TEXT",
                "isUnique": true,
                "valueHint": "(not set)",
                "valueValidators": [
                  {
                    "type": "NON_EMPTY"
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!event_type$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override event_type parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!channel_grouping$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override channel_grouping parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!source$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override source parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!campaign$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override campaign parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!campaign_id$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override campaign_id parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!campaign_term$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override campaign_term parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!campaign_content$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override campaign_content parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_id$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_id parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_title$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_title parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_hostname_protocol$).*"
                    ],
                    "enablingConditions": [],
                    "errorMessage": "Can\u0027t add/override page_hostname_protocol parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_hostname$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_hostname parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_location$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_location parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_fragment$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_fragment parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_query$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_query parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_extension$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_extension parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_referrer$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_referrer parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_language$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_language parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_status_code$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_status_code parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!cs_container_id$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override cs_container_id parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_agent$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override user_agent parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!browser_name$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override browser_name parameter."
                  },
                  {
                    "type": "REGEX",
                    "enablingConditions": [],
                    "args": [
                      "^(?!browser_language$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override browser_language parameter."
                  },
                  {
                    "type": "REGEX",
                    "errorMessage": "Can\u0027t add/override browser_version parameter.",
                    "args": [
                      "^(?!browser_version$).*"
                    ]
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!device_type$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override device_type parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!device_vendor$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override device_vendor parameter."
                  },
                  {
                    "type": "REGEX",
                    "errorMessage": "Can\u0027t add/override device_model parameter.",
                    "args": [
                      "^(?!device_model$).*"
                    ]
                  },
                  {
                    "type": "REGEX",
                    "errorMessage": "Can\u0027t add/override os_name parameter.",
                    "args": [
                      "^(?!os_name$).*"
                    ]
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!os_version$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override os_version parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!screen_size$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override screen_size parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!viewport_size$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override viewport_size parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!country$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override country parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!city$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override city parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!ss_hostname$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override ss_hostname parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!ss_container_id$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override ss_container_id parameter."
                  }
                ]
              },
              {
                "defaultValue": "",
                "displayName": "Param value",
                "name": "param_value",
                "type": "TEXT",
                "valueHint": "(not set)",
                "valueValidators": [
                  {
                    "type": "NON_EMPTY"
                  }
                ]
              }
            ],
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "alwaysInSummary": true,
            "enablingConditions": [
              {
                "paramName": "add_event_parameters",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          }
        ],
        "alwaysInSummary": true,
        "help": "Add or override event parameters to the request in event_data. If a parameter has the same name, it will be overridden.\n\u003c/br\u003e\u003c/br\u003e\nReserved event parameters: \u003c/br\u003e \n• event_type \u003c/br\u003e \n• channel_grouping \u003c/br\u003e \n• source \u003c/br\u003e \n• campaign \u003c/br\u003e \n• campaign_id \u003c/br\u003e \n• campaign_term \u003c/br\u003e \n• campaign_content \u003c/br\u003e \n• page_id \u003c/br\u003e \n• page_title \u003c/br\u003e \n• page_hostname_protocol \u003c/br\u003e \n• page_hostname \u003c/br\u003e \n• page_location \u003c/br\u003e \n• page_fragment \u003c/br\u003e \n• page_query \u003c/br\u003e \n• page_extension \u003c/br\u003e \n• page_referrer \u003c/br\u003e \n• page_language \u003c/br\u003e \n• page_status_code \u003c/br\u003e \n• cs_container_id \u003c/br\u003e \n• user_agent \u003c/br\u003e \n• browser_name \u003c/br\u003e \n• browser_language \u003c/br\u003e \n• browser_version \u003c/br\u003e \n• device_type \u003c/br\u003e \n• device_vendor \u003c/br\u003e \n• device_model \u003c/br\u003e \n• os_name \u003c/br\u003e \n• os_version \u003c/br\u003e \n• screen_size \u003c/br\u003e \n• viewport_size \u003c/br\u003e \n• country \u003c/br\u003e \n• city \u003c/br\u003e \n• ss_hostname \u003c/br\u003e \n• ss_container_id \u003c/br\u003e",
        "defaultValue": false,
        "displayName": "Event parameters"
      },
      {
        "type": "CHECKBOX",
        "name": "remove_event_parameters",
        "checkboxText": "Remove event level parameters",
        "simpleValueType": true,
        "subParams": [
          {
            "type": "SIMPLE_TABLE",
            "name": "event_params_to_remove",
            "displayName": "Event parameters",
            "simpleTableColumns": [
              {
                "defaultValue": "",
                "displayName": "Param name",
                "name": "param_name",
                "type": "TEXT",
                "isUnique": true,
                "valueHint": "(not set)",
                "valueValidators": [
                  {
                    "type": "NON_EMPTY"
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!event_type$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override event_type parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!channel_grouping$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override channel_grouping parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!source$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override source parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!campaign$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override campaign parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!campaign_id$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override campaign_id parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!campaign_term$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override campaign_term parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!campaign_content$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override campaign_content parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_id$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_id parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_title$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_title parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_hostname_protocol$).*"
                    ],
                    "enablingConditions": [],
                    "errorMessage": "Can\u0027t add/override page_hostname_protocol parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_hostname$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_hostname parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_location$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_location parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_fragment$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_fragment parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_query$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_query parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_extension$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_extension parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_referrer$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_referrer parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_language$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_language parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!page_status_code$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override page_status_code parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!cs_container_id$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override cs_container_id parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!user_agent$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override user_agent parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!browser_name$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override browser_name parameter."
                  },
                  {
                    "type": "REGEX",
                    "errorMessage": "Can\u0027t add/override browser_name parameter.",
                    "args": [
                      "^(?!browser_name$).*"
                    ]
                  },
                  {
                    "type": "REGEX",
                    "enablingConditions": [],
                    "args": [
                      "^(?!browser_language$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override browser_language parameter."
                  },
                  {
                    "type": "REGEX",
                    "errorMessage": "Can\u0027t add/override browser_version parameter.",
                    "args": [
                      "^(?!browser_version$).*"
                    ]
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!device_type$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override device_type parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!device_vendor$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override device_vendor parameter."
                  },
                  {
                    "type": "REGEX",
                    "errorMessage": "Can\u0027t add/override device_model parameter.",
                    "args": [
                      "^(?!device_model$).*"
                    ]
                  },
                  {
                    "type": "REGEX",
                    "errorMessage": "Can\u0027t add/override os_name parameter.",
                    "args": [
                      "^(?!os_name$).*"
                    ]
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!os_version$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override os_version parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!screen_size$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override screen_size parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!viewport_size$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override viewport_size parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!country$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override country parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!city$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override city parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!ss_hostname$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override ss_hostname parameter."
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^(?!ss_container_id$).*"
                    ],
                    "errorMessage": "Can\u0027t add/override ss_container_id parameter."
                  }
                ]
              }
            ],
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "alwaysInSummary": true,
            "enablingConditions": [
              {
                "paramName": "remove_event_parameters",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          }
        ],
        "alwaysInSummary": true,
        "help": "Remove event parameters from the request in event_data. If a parameter has the same name, it will be overridden.\n\u003c/br\u003e\u003c/br\u003e\nReserved event parameters: \u003c/br\u003e \n• event_type \u003c/br\u003e \n• channel_grouping \u003c/br\u003e \n• source \u003c/br\u003e \n• campaign \u003c/br\u003e \n• campaign_id \u003c/br\u003e \n• campaign_term \u003c/br\u003e \n• campaign_content \u003c/br\u003e \n• page_id \u003c/br\u003e \n• page_title \u003c/br\u003e \n• page_hostname_protocol \u003c/br\u003e \n• page_hostname \u003c/br\u003e \n• page_location \u003c/br\u003e \n• page_fragment \u003c/br\u003e \n• page_query \u003c/br\u003e \n• page_extension \u003c/br\u003e \n• page_referrer \u003c/br\u003e \n• page_language \u003c/br\u003e \n• page_status_code \u003c/br\u003e \n• cs_container_id \u003c/br\u003e \n• user_agent \u003c/br\u003e \n• browser_name \u003c/br\u003e \n• browser_language \u003c/br\u003e \n• browser_version \u003c/br\u003e \n• device_type \u003c/br\u003e \n• device_vendor \u003c/br\u003e \n• device_model \u003c/br\u003e \n• os_name \u003c/br\u003e \n• os_version \u003c/br\u003e \n• screen_size \u003c/br\u003e \n• viewport_size \u003c/br\u003e \n• country \u003c/br\u003e \n• city \u003c/br\u003e \n• ss_hostname \u003c/br\u003e \n• ss_container_id \u003c/br\u003e",
        "defaultValue": false,
        "displayName": ""
      }
    ]
  },
  {
    "type": "LABEL",
    "name": "settings_title",
    "displayName": "\u003c/br\u003e\u003cb\u003eSettings\u003c/b\u003e"
  },
  {
    "type": "GROUP",
    "name": "client_settings",
    "displayName": "Client settings",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "TEXT",
        "name": "endpoint",
        "displayName": "Endpoint path",
        "simpleValueType": true,
        "alwaysInSummary": true,
        "valueHint": "(not set)",
        "valueValidators": [
          {
            "type": "NON_EMPTY",
            "enablingConditions": []
          },
          {
            "type": "REGEX",
            "args": [
              "^/.*(?\u003c!/)$"
            ],
            "errorMessage": "The endpoint path must start with / and must not end with /."
          }
        ],
        "help": "The request endpoint path.\n\u003c/br\u003e\u003c/br\u003e\nThe endpoint path must start with / and must not end with /."
      },
      {
        "type": "TEXT",
        "name": "bq_project_id",
        "displayName": "Google BigQuery project ID",
        "simpleValueType": true,
        "valueHint": "(not set)",
        "help": "Google Cloud project ID for BigQuery.",
        "alwaysInSummary": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "enablingConditions": []
      },
      {
        "type": "TEXT",
        "name": "bq_dataset_id",
        "displayName": "Google BigQuery dataset ID",
        "simpleValueType": true,
        "valueHint": "(not set)",
        "help": "BigQuery dataset ID.",
        "alwaysInSummary": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "enablingConditions": []
      },
      {
        "type": "TEXT",
        "name": "bq_table_id",
        "displayName": "Google BigQuery table ID",
        "simpleValueType": true,
        "valueHint": "(not set)",
        "help": "BigQuery table ID. \n\u003cbr\u003e\u003cbr\u003e\n\u003cb\u003eCreate the table before start sending events.\u003c/b\u003e",
        "alwaysInSummary": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "enablingConditions": []
      },
      {
        "type": "CHECKBOX",
        "name": "add_authorized_domains",
        "checkboxText": "Restrict requests to authorized domains",
        "simpleValueType": true,
        "subParams": [
          {
            "type": "SIMPLE_TABLE",
            "name": "authorized_domains_list",
            "simpleTableColumns": [
              {
                "defaultValue": "",
                "displayName": "Domain name",
                "name": "authorized_domain",
                "type": "TEXT",
                "isUnique": true,
                "valueValidators": [
                  {
                    "type": "NON_EMPTY"
                  },
                  {
                    "type": "REGEX",
                    "args": [
                      "^([a-zA-Z0-9-]+\\.)+[a-zA-Z]{2,}$"
                    ],
                    "errorMessage": "The URL must not start with http:// or https://, must not end with /, and must contain a valid domain."
                  }
                ],
                "valueHint": "(not set)"
              }
            ],
            "alwaysInSummary": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "displayName": "Authorized domains",
            "enablingConditions": [
              {
                "paramName": "add_authorized_domains",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          }
        ],
        "alwaysInSummary": true,
        "help": "Authorized domains from which to accept requests.  \u003c/br\u003e\u003c/br\u003e The URL must start with https:/, must not end with /, and contain a valid domain."
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "session_settings",
    "displayName": "Session settings",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "change_user_cookie_name",
        "checkboxText": "Change user cookie name",
        "simpleValueType": true,
        "displayName": "",
        "help": "Override the default user cookie name.",
        "defaultValue": false,
        "alwaysInSummary": true,
        "subParams": [
          {
            "type": "TEXT",
            "name": "user_cookie_name",
            "displayName": "User cookie name",
            "simpleValueType": true,
            "valueHint": "(not set)",
            "help": "",
            "alwaysInSummary": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "enablingConditions": [
              {
                "paramName": "change_user_cookie_name",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "change_session_cookie_name",
        "checkboxText": "Change session cookie name",
        "simpleValueType": true,
        "displayName": "",
        "help": "Overrides the default session cookie name.",
        "defaultValue": false,
        "alwaysInSummary": true,
        "subParams": [
          {
            "type": "TEXT",
            "name": "session_cookie_name",
            "displayName": "Session cookie name",
            "simpleValueType": true,
            "valueHint": "(not set)",
            "help": "",
            "alwaysInSummary": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "enablingConditions": [
              {
                "paramName": "change_session_cookie_name",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "change_default_session_duration",
        "checkboxText": "Change default session duration",
        "simpleValueType": true,
        "displayName": "",
        "help": "Override the default duration (30 min) of the session cookie.",
        "defaultValue": false,
        "alwaysInSummary": true,
        "subParams": [
          {
            "type": "TEXT",
            "name": "session_max_age",
            "displayName": "Session duration",
            "simpleValueType": true,
            "enablingConditions": [
              {
                "paramName": "change_default_session_duration",
                "paramValue": true,
                "type": "EQUALS"
              }
            ],
            "alwaysInSummary": true,
            "valueUnit": "min",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              },
              {
                "type": "POSITIVE_NUMBER"
              },
              {
                "type": "NUMBER"
              }
            ],
            "valueHint": "(not set)"
          }
        ]
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "advanced_settings",
    "displayName": "Advanced settings",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "send_data_to_custom_endpoint",
        "checkboxText": "Send data to custom endpoint",
        "simpleValueType": true,
        "displayName": "",
        "help": "Send data to custom endpoint, via POST requestin JSON format.",
        "defaultValue": false,
        "alwaysInSummary": true,
        "subParams": [
          {
            "type": "TEXT",
            "name": "custom_request_endpoint_path",
            "displayName": "Full endpoint domain path",
            "simpleValueType": true,
            "valueHint": "(not set)",
            "help": "",
            "alwaysInSummary": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              },
              {
                "type": "REGEX",
                "args": [
                  "^https:\\/\\/([a-zA-Z0-9-]+\\.)+[a-zA-Z]{2,}$"
                ],
                "errorMessage": "The URL must starts with https:// and contains a valid domain."
              }
            ],
            "enablingConditions": [
              {
                "paramName": "send_data_to_custom_endpoint",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          },
          {
            "type": "CHECKBOX",
            "name": "add_custom_request_headers",
            "checkboxText": "Add custom request headers",
            "simpleValueType": true,
            "displayName": "",
            "help": "Add custom request headers.",
            "defaultValue": false,
            "alwaysInSummary": true,
            "enablingConditions": [
              {
                "paramName": "send_data_to_custom_endpoint",
                "paramValue": true,
                "type": "EQUALS"
              }
            ],
            "subParams": [
              {
                "type": "SIMPLE_TABLE",
                "name": "custom_request_headers",
                "displayName": "Custom request headers",
                "simpleTableColumns": [
                  {
                    "defaultValue": "",
                    "displayName": "Header name",
                    "name": "header_name",
                    "type": "TEXT",
                    "isUnique": true,
                    "valueValidators": [
                      {
                        "type": "NON_EMPTY"
                      }
                    ]
                  },
                  {
                    "defaultValue": "",
                    "displayName": "Header value",
                    "name": "header_value",
                    "type": "TEXT",
                    "valueValidators": [],
                    "isUnique": false
                  }
                ],
                "alwaysInSummary": true,
                "enablingConditions": [
                  {
                    "paramName": "add_custom_request_headers",
                    "paramValue": true,
                    "type": "EQUALS"
                  }
                ],
                "newRowButtonText": "Add new header",
                "valueValidators": [
                  {
                    "type": "NON_EMPTY"
                  }
                ]
              }
            ]
          }
        ]
      },
      {
        "type": "CHECKBOX",
        "name": "enable_logs",
        "checkboxText": "Enable logs in debug view",
        "simpleValueType": true,
        "alwaysInSummary": true,
        "displayName": "",
        "help": "Enable logging on GTM debug console.",
        "defaultValue": true
      }
    ],
    "help": "Lorem ipsum"
  },
  {
    "type": "GROUP",
    "name": "credits",
    "displayName": "Info",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "LABEL",
        "name": "info",
        "displayName": "\u003cb\u003eNameless Analytics Server-Side client tag\u003c/b\u003e\u003c/br\u003e\nBeta version: 1.0. \n\u003c/br\u003e\nRead more about the \n\u003ca href\u003d\"https://github.com/tommasomoretti/nameless-analytics\" target\u003d\u0027_blank\u0027 rel\u003d\"noopener\"\u003eNameless Analytics project\u003c/a\u003e or the \u003ca href\u003d\"https://github.com/tommasomoretti/nameless-analytics-server-tag\" target\u003d\u0027_blank\u0027 rel\u003d\"noopener\"\u003eServer-side Client Tag\u003c/a\u003e.\n\u003c/br\u003e\nCreated by \u003ca href\u003d\"https://tommasomoretti.com/?utm_source\u003dtagmanager.google.com\u0026utm_medium\u003dreferral\u0026utm_campaign\u003dss_analytics_tag\" target\u003d\u0027_blank\u0027 rel\u003d\"noopener\"\u003eTommaso Moretti\u003c/a\u003e\n\u003c/br\u003e\u003c/br\u003e"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

const log = require('logToConsole');
const getTimestampMillis = require('getTimestampMillis');

const claimRequest = require('claimRequest');
const getRequestHeader = require('getRequestHeader');
const getRequestBody = require('getRequestBody');
const getRequestMethod = require('getRequestMethod');
const getRequestPath = require('getRequestPath');
const setResponseHeader = require('setResponseHeader');
const setResponseBody = require('setResponseBody');
const setResponseStatus = require('setResponseStatus');
const returnResponse = require('returnResponse');
const runContainer = require('runContainer');
const JSON = require('JSON');
const Object = require('Object');
const getType = require('getType');
const makeNumber = require('makeNumber');
const generateRandom = require('generateRandom');
const getContainerVersion = require('getContainerVersion');
const getCookieValues = require('getCookieValues');
const setCookie = require ('setCookie');
const computeEffectiveTldPlusOne = require('computeEffectiveTldPlusOne');
const BigQuery = require('BigQuery');
const Firestore = require('Firestore');
const sendHttpRequest = require('sendHttpRequest');


// ------------------------------------------------------------------------------------------------------------------------------------------------------


const endpoint = data.endpoint;
const request_origin = getRequestHeader('Origin');
const request_method = getRequestMethod();
const authorized_domains_list = (data.add_authorized_domains) ? data.authorized_domains_list : [request_origin];
var authorized_domains = '';

const user_cookie_name = data.user_cookie_name || 'nameless_analytics_user';
const user_cookie_value = getCookieValues(user_cookie_name)[0];

const session_cookie_name = data.session_cookie_name || 'nameless_analytics_session';
const session_cookie_value = getCookieValues(session_cookie_name)[0];

if(data.enable_logs){log('NAMELESS ANALYTICS');}
if(data.enable_logs){log('CLIENT TAG CONFIGURATION');}

for(let i = 0; i < authorized_domains_list.length; i++){
  const authorized_domains_tld = computeEffectiveTldPlusOne(authorized_domains_list[i].authorized_domain);
  authorized_domains = authorized_domains.concat(', ', authorized_domains_tld);
} 
if(data.enable_logs){log('👉 Authorized origins:', (data.add_authorized_domains) ? authorized_domains.slice(2) : ' All');}
if(data.enable_logs){log('👉 Endpoint:', endpoint);}

// Check origin, request endpoint and required fields and claim requests
if (check_origin()){  
  // Check request endpoint
  if(getRequestPath() === endpoint){  
    if(request_method === 'POST'){
      const event_data = JSON.parse(getRequestBody());
      
      // Check required fields
      if(event_data && Object.keys(event_data).length > 0) {
        const missingFields = [];

        const event_origin = event_data.event_origin;
        if(!event_origin) missingFields.push('event_origin');
        
        const event_date = event_data.event_date;
        if(!event_date) missingFields.push('event_date');
        
        const event_name = event_data.event_name;
        if(!event_name) missingFields.push('event_name');
  
        const event_timestamp = event_data.event_timestamp;
        if(!event_timestamp) missingFields.push('event_timestamp');
        
        const client_id = event_data.client_id;
        if(!client_id && event_origin == 'Streaming protocol') missingFields.push('client_id');

        const session_id = event_data.session_id;
        if(!session_id && event_origin == 'Streaming protocol') missingFields.push('session_id');

        const user_data_obj = event_data.user_data;
        if(!user_data_obj || user_data_obj == "{}") missingFields.push('user_data');

        const session_data_obj = event_data.session_data;
        if(!session_data_obj || session_data_obj == "{}") missingFields.push('session_data');

        const event_data_obj = event_data.event_data;
        if(!event_data_obj || event_data_obj == "{}") missingFields.push('event_data');
        
        if(event_data_obj && event_data_obj != "{}") {
          const page_id = event_data.event_data.page_id;
          if(!page_id) missingFields.push('page_id');
          
          const event_id = event_data.event_id;
          if(!event_id) missingFields.push('event_id');
        }
                
        var response_error;
        
        // REJECT REQUESTS 
        // Check cookie name
        if (user_cookie_name == session_cookie_name){
          response_error = "🔴 User cookie name and session cookie name can't be equal";
          
        // Check required fields
        } else if (missingFields.length > 0 && event_name != 'get_user_data') {
          response_error = '🔴 Missing event parameters: '.concat(missingFields.join(', '));
          
        // Check event origin 
        } else if (event_origin !== 'Website' && event_origin !== 'Streaming protocol' && event_name != 'get_user_data') {
          response_error = '🔴 Invalid event_origin parameter value. Accepted values: Website or Streaming protocol';
                
        // CLAIM REQUESTS 
        // Claim requests for get_user_data
        } else if(event_name == 'get_user_data') {
          if(data.enable_logs){log('CLAIM REQUEST...');}
          if(data.enable_logs){log('👉 Request from get_user_data event');}
          
          if(event_origin && event_origin == 'Website'){
            claim_request(get_user_data());
          } else {
            response_error = '🔴 Invalid event_origin parameter value. Accepted value: Website';
            if(data.enable_logs) {log(response_error);}
          } 

        // Claim standard requests
        } else {
          if(data.enable_logs){log('CLAIM REQUEST...');}

          claim_request(add_data_to_payload(set_ids(event_data)));
        }
        
        // RETURN RESPONSE ERRORS
        if(response_error) {
          return_response_error(response_error);
        }
        
      } else {
        // RETURN RESPONSE ERRORS
        return_response_error('🔴 Empty or bad formatted request body');
      }
    }
  } else {
    // RETURN RESPONSE ERRORS
    return_response_error('🔴 The request endpoint is not correct');
  }
} else {
  // RETURN RESPONSE ERRORS
  return_response_error('🔴 The request origin is not authorized');
}


// Check request origin
function check_origin(){
  if (data.add_authorized_domains) {
    for(let i = 0; i < authorized_domains_list.length; i++){    
      if(computeEffectiveTldPlusOne(request_origin) == computeEffectiveTldPlusOne(authorized_domains_list[i].authorized_domain)){
        return true;
      }
    }
  } else {
    return true;
  }
}



// ------------------------------------------------------------------------------------------------------------------------------------------------------



// Build response for get_user_data requests (For cross-domain only)
function get_user_data() {   
  const client_id = user_cookie_value || 'undefined';
  const session_id = session_cookie_value || 'undefined';
  const page_id = (session_cookie_value) ? session_cookie_value.split('-')[1] : 'undefined';
  
  const event_data = {
    event_name: 'get_user_data',
    client_id: client_id,
    session_id: session_id.split('-')[0] || 'undefined',
    page_id: page_id
  };
    
  return event_data;
}



// ------------------------------------------------------------------------------------------------------------------------------------------------------



// Handle client id and session_id for standard requests
function set_ids(event_data){
  // Streaming protocol
  if(event_data.event_origin == 'Streaming protocol'){
    if(data.enable_logs){log('👉 Request from Streaming protocol');}
    if(data.enable_logs){log('👉 Event name: ', event_data.event_name);}
    
    event_data.event_data.page_id = event_data.session_id + '-' + event_data.event_data.page_id;
    event_data.event_id = event_data.session_id + '-' + event_data.event_id;
    event_data.event_data.page_hostname = computeEffectiveTldPlusOne(request_origin);
    
    add_data_to_payload(event_data);
    
    return event_data; 
    
  // Website  
  } else if (event_data.event_origin == 'Website') {
    if(data.enable_logs){log('👉 Request from website');}
    if(data.enable_logs){log('👉 Event name: ', event_data.event_name);}
    
    const page_id = event_data.event_data.page_id;
    const event_id = event_data.event_id;  
    const cross_domain_id = event_data.event_data.cross_domain_id;
    
    // Cross-domain request
    if (cross_domain_id) {
      const cross_domain_client_id = cross_domain_id.split('_')[0];
      const cross_domain_session_id = cross_domain_id;
      
      if(data.enable_logs){log('👉 Cross-domain visit.');}
      
      // With an active session
      if (session_cookie_value){
        // With different session id
        if (cross_domain_session_id != session_cookie_value.split('-')[0]) {       
          event_data.client_id = cross_domain_client_id;
          event_data.session_id = cross_domain_session_id;
          event_data.event_data.page_id = cross_domain_session_id + '-' + page_id;
          event_data.event_id = cross_domain_session_id + '-' + event_id;
       
          if(data.enable_logs){log('👉 Create new client_id: ', cross_domain_client_id + ' and new session_id: ', cross_domain_session_id);}
          
          // set_user_cookie(user_cookie_name, cross_domain_client_id);
          // set_session_cookie(session_cookie_name, event_data.event_data.page_id);
        
        // With the same session id   
        } else {   
          const old_client_id = user_cookie_value;
          const old_session_id = session_cookie_value.split('-')[0];
          
          event_data.client_id = old_client_id;
          event_data.session_id = old_session_id;
          event_data.event_data.page_id = old_session_id + '-' + page_id;
          event_data.event_id = old_session_id + '-' + event_id;
          
          if(data.enable_logs){log('👉 Same client_id, same session_id.');}
          if(data.enable_logs){log('👉 Extend cookies max-age.');}
          
          // set_user_cookie(user_cookie_name, old_client_id);
          // set_session_cookie(session_cookie_name, event_data.event_data.page_id);
        }
      // Without an active session         
      } else {
        event_data.client_id = cross_domain_client_id;
        event_data.session_id = cross_domain_session_id;
        event_data.event_data.page_id = cross_domain_session_id + '-' + page_id;
        event_data.event_id = cross_domain_session_id + '-' + event_id;
        
        if(data.enable_logs){log('👉 Returning user, no active session.');}
        if(data.enable_logs){log('👉 Same client_id: ', cross_domain_client_id + ', create new session_id: ', cross_domain_session_id);}
        
        // set_user_cookie(user_cookie_name, cross_domain_client_id);
        // set_session_cookie(session_cookie_name, event_data.event_data.page_id);
      }
      
    // No cross-domain request
    } else {          
      // New user
      if (user_cookie_value === undefined) {
        const new_client_id = generate_alphanumeric();
        const new_session_id = new_client_id + '_' + generate_alphanumeric();
          
        event_data.client_id = new_client_id;
        event_data.session_id = new_session_id;
        event_data.event_data.page_id = new_session_id + '-' + page_id;
        event_data.event_id = new_session_id + '-' + event_id;
        
        if(data.enable_logs){log('👉 New user, no active session.');}
        if(data.enable_logs){log('👉 Create new client_id: ', new_client_id + ' and new session_id: ', new_session_id);}
     
        // set_user_cookie(user_cookie_name, new_client_id);
        // set_session_cookie(session_cookie_name, event_data.event_data.page_id);
      
      // Returning user
      } else if (user_cookie_value != undefined) {
        // No session cookie
        if (session_cookie_value === undefined){
          const old_client_id = user_cookie_value;
          const new_session_id = old_client_id + '_' + generate_alphanumeric();          
          
          event_data.client_id = old_client_id;
          event_data.session_id = new_session_id;
          event_data.event_data.page_id = new_session_id + '-' + page_id;
          event_data.event_id = new_session_id + '-' + event_id;    
          
          if(data.enable_logs){log('👉 Returning user, no active session.');}
          if(data.enable_logs){log('👉 Same client_id: ', old_client_id + ', create new session_id: ', new_session_id);}
                                         
          // set_user_cookie(user_cookie_name, old_client_id);
          // set_session_cookie(session_cookie_name, event_data.event_data.page_id);
        // Yes session cookie
        } else {
          const old_client_id = user_cookie_value;
          const old_session_id = session_cookie_value.split('-')[0];
                  
          event_data.client_id = old_client_id;
          event_data.session_id = old_session_id;
          event_data.event_data.page_id = old_session_id + '-' + page_id;
          event_data.event_id = old_session_id + '-' + event_id;
          
          if(data.enable_logs){log('👉 Same client_id, same session_id.');}
          if(data.enable_logs){log('👉 Extend cookies max-age.');}
     
          // set_user_cookie(user_cookie_name, old_client_id);
          // set_session_cookie(session_cookie_name, event_data.event_data.page_id);
        }
      }
    }
            
    return event_data;
    
  }
} 



// ------------------------------------------------------------------------------------------------------------------------------------------------------



// Enhance payload data
function add_data_to_payload(event_data){
  // Add additional info    
  event_data.processing_event_timestamp = getTimestampMillis();
  event_data.content_length = makeNumber(getRequestHeader('content-length'));
  if(event_data.event_origin == 'Website' || event_data.event_origin == 'Streaming protocol') {
    event_data.event_data.country = getRequestHeader('X-Appengine-Country');
    event_data.event_data.city = getRequestHeader('X-Appengine-City');
  }
  event_data.event_data.ss_hostname = getRequestHeader('Host');
  event_data.event_data.ss_container_id = getContainerVersion().containerId;
  
  
  // User data
  // Add or override user ID
  if (data.override_user_id) {
    event_data.user_data.user_id = (data.user_id == "null")? null : data.user_id;
  }
  
  // Add user data from tag fields
  if (data.add_user_parameters) {
    const user_params = data.user_params_to_add;
    
    if (user_params !== undefined) {
      for (let i = 0; i < user_params.length; i++) {
        const param_name = user_params[i].param_name;
        const param_value = user_params[i].param_value;
        
        event_data.user_data[param_name] = param_value;
      }
    }
  }
  
  // Remove user data from tag fields
  if (data.remove_user_parameters) {
    const user_params = data.user_params_to_remove;
    
    if (user_params !== undefined) {
      for (let i = 0; i < user_params.length; i++) {
        const param_name = user_params[i].param_name;

        Object.delete(event_data.user_data, param_name);
      }
    }
  } 
  
  
  // Session data
    // Add session data from tag fields
  if (data.add_session_parameters) {
    const session_params = data.session_params_to_add;
    
    if (session_params !== undefined) {
      for (let i = 0; i < session_params.length; i++) {
        const param_name = session_params[i].param_name;
        const param_value = session_params[i].param_value;
        
        event_data.session_data[param_name] = param_value;
      }
    }
  }
  
  // Remove session data from tag fields
  if (data.remove_session_parameters) {
    const session_params = data.session_params_to_remove;
    
    if (session_params !== undefined) {
      for (let i = 0; i < session_params.length; i++) {
        const param_name = session_params[i].param_name;
        
        Object.delete(event_data.session_data, param_name);
      }
    }
  } 
  
  
  // Event data
  event_data.event_data.tld_source = (computeEffectiveTldPlusOne(event_data.event_data.source) !== '') ? computeEffectiveTldPlusOne(event_data.event_data.source) : event_data.event_data.source;  
  
  // Add event data from tag fields
  if (data.add_event_parameters) {
    const event_params = data.event_params_to_add;
    
    if (event_params !== undefined) {
      for (let i = 0; i < event_params.length; i++) {
        const param_name = event_params[i].param_name;
        const param_value = event_params[i].param_value;
        
        event_data.event_data[param_name] = param_value;
      }
    }
  }
  
  // Remove event data from tag fields
  if (data.remove_event_parameters) {
    const event_params = data.event_params_to_remove;
    
    if (event_params !== undefined) {
      for (let i = 0; i < event_params.length; i++) {
        const param_name = event_params[i].param_name;
        
        Object.delete(event_data.event_data, param_name);
      }
    }
  }  

  return event_data;
}


// Generate random alphanumeric ID 
function generate_alphanumeric() {
 var max_length = 15; // Change this to the desired length
 var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
 var alphanumeric_id = '';
  
 for (var i = 0; i < max_length; i++) {
   alphanumeric_id += chars.charAt(generateRandom(0, chars.length));
 }
  
 return alphanumeric_id;
}



// ------------------------------------------------------------------------------------------------------------------------------------------------------



// Claim requests
function claim_request(event_data) {
  claimRequest();
    
  // Get user data requests
  if (event_data.event_name == 'get_user_data') {    
    return_response(event_data);
    
    if(data.enable_logs){log('SEND USER DATA BACK TO BROWSER...');}
    if(data.enable_logs){log('👉 Client ID:', event_data.client_id);}
    if(data.enable_logs){log('👉 Session ID:', event_data.session_id);}
    if(data.enable_logs){log('🟢 User data has been sent back correctly to the browser');}
     
  // Standard requests
  } else {
    // Send data to Firestore
    send_to_firestore(event_data)
    // Return response
    .then((res) => {
      if(res.status == true) {return_response(event_data);}
      else {return_response_error(res.response_error);}
      return res;
    })
    // Send data to BigQuery
    .then((res) => {
      if (res.status == true) {
        if (data.enable_logs) {log('SEND EVENT DATA TO GOOGLE BIGQUERY...');}
        send_to_bq(event_data);
      }
      return res;
    })
    // Send data to custom endpoint
    .then((res) => {
      if(res.status == true){
        if (data.send_data_to_custom_endpoint) {
          if (data.enable_logs) {log('SEND EVENT DATA TO CUSTOM ENDPOINT...');}
          send_to_custom_endpoint(data.custom_request_endpoint_path, event_data);
        }
      }
    });
  }
}


// Return response
function return_response(event_data) { 
  runContainer(event_data, () => {
    setResponseStatus(200);
    setResponseHeader('Access-Control-Allow-Credentials', 'true');
    setResponseHeader('Access-Control-Allow-Origin', request_origin);
    setResponseHeader('Access-Control-Allow-Methods', 'POST');
    setResponseHeader('cache-control', 'no-store');
    setResponseBody(JSON.stringify({
      status_code: 200,
      response: '🟢 Request claimed succesfully',
      data: event_data
    }));
    
    returnResponse();
    if(data.enable_logs){log('🟢 Request claimed succesfully');}
  });
}


// Return response error
function return_response_error(response_error){
  setResponseStatus(500);
  setResponseHeader('Access-Control-Allow-Credentials', 'true');
  setResponseHeader('Access-Control-Allow-Origin', request_origin);
  setResponseBody(JSON.stringify({
      status_code: 500,
      response: response_error
  }));
  
  returnResponse();
  if(data.enable_logs){log(response_error);}
}



// ------------------------------------------------------------------------------------------------------------------------------------------------------



// Send data to Google Firestore
function send_to_firestore(event_data) {
  const projectId = data.bq_project_id;
  const queries = [['client_id', '==', event_data.client_id]];
  const collection_path = 'users';
  const document_path = collection_path + '/' + event_data.client_id;
  
  return Firestore.query(collection_path, queries, {projectId: projectId, limit: 1})
  .then((documents) => {
    
    let response_error = ''; 
    
    // REJECT REQUESTS (orphan events) 
    if(event_data.event_origin == 'Website' && event_data.event_name != 'page_view' && event_data.event_name != 'get_user_data' && user_cookie_value == undefined) {
      response_error = '🔴 Website orphan event. Trigger a page_view event first to create a new user and a new session.';
      return {status: false, response_error: response_error};
    } else if (event_data.event_origin == 'Website' && event_data.event_name != 'page_view' && event_data.event_name != 'get_user_data' && session_cookie_value == undefined) {
      response_error = '🔴 Website orphan event. Trigger a page_view event first to create a new session.';
      return {status: false, response_error: response_error};
    } else if (event_data.event_origin == 'Streaming protocol' && documents.length === 0) {
      response_error = '🔴 Streaming protocol orphan event. Trigger a page_view event from website first to create a new user and a new session.';
      return {status: false, response_error: response_error};
    } else if (event_data.event_origin == 'Streaming protocol' && event_data.session_id != documents[0].data.sessions.slice(-1)[0].session_id) {
      response_error = '🔴 Streaming protocol orphan event. Trigger a page_view event from website first to create a new session.';
      return {status: false, response_error: response_error};
    } 
    
    // Set cookies
    set_user_cookie(user_cookie_name, event_data.client_id);
    set_session_cookie(session_cookie_name, event_data.event_data.page_id);
  
    // Create user_data and session_data if not exist 
    if (!event_data.user_data) {event_data.user_data = {};}
    if (!event_data.session_data) {event_data.session_data = {};}
        
    // If user does not exist in Firestore
    if (documents && documents.length === 0) {
      if(data.enable_logs){log('SEND EVENT DATA TO GOOGLE FIRESTORE...');}          
      if(data.enable_logs){log('👉 User does not exist');}
      if(data.enable_logs){log('👉 Session does not exist');}
      
      // Set user and session parameter values for Firestore from current event data
      const firestore_data = {
        user_date: event_data.event_date,
        client_id: event_data.client_id,
        user_channel_grouping: event_data.event_data.channel_grouping,
        user_source: event_data.event_data.source,
        user_tld_source: event_data.event_data.tld_source,
        user_campaign: event_data.event_data.campaign,
        user_campaign_id: event_data.event_data.campaign_id,
        user_device_type: event_data.event_data.device_type,
        user_country: event_data.event_data.country,
        user_language: event_data.event_data.browser_language,
        user_first_session_timestamp: (event_data.event_name == 'page_view') ? event_data.event_timestamp : 'null',
        user_last_session_timestamp: (event_data.event_name == 'page_view') ? event_data.event_timestamp : 'null',
        sessions: [{
          session_date: event_data.event_date,
          session_id: event_data.session_id,
          session_number: 1,
          cross_domain_session: (event_data.event_data.cross_domain_id) ? 'Yes' : 'No',
          session_channel_grouping: event_data.event_data.channel_grouping,
          session_source: event_data.event_data.source,
          session_tld_source: event_data.event_data.tld_source,           
          session_campaign: event_data.event_data.campaign,
          session_campaign_content: event_data.event_data.campaign_content,
          session_campaign_id: event_data.event_data.campaign_id,
          session_campaign_term: event_data.event_data.campaign_term,
          session_device_type: event_data.event_data.device_type,
          session_country: event_data.event_data.country,
          session_language: event_data.event_data.browser_language,
          session_hostname: event_data.event_data.page_hostname,
          session_browser_name: event_data.event_data.browser_name,
          session_landing_page_category: event_data.event_data.page_category,            
          session_landing_page_location: event_data.event_data.page_location,
          session_landing_page_title: event_data.event_data.page_title,
          session_exit_page_category: event_data.event_data.page_category,
          session_exit_page_location: event_data.event_data.page_location,
          session_exit_page_title: event_data.event_data.page_title,
          session_start_timestamp: (event_data.event_name == 'page_view') ? event_data.event_timestamp : 'null',
          session_end_timestamp: event_data.event_timestamp,
        }]
      };
        
      // Add user parameters to Firestore
      for (let key in event_data.user_data) {
        if (event_data.user_data.hasOwnProperty(key)) {
          firestore_data[key] = event_data.user_data[key];
        }
      }
        
      // Add session parameters to Firestore
      for (let key in event_data.session_data) {
        if (event_data.session_data.hasOwnProperty(key)) {
          firestore_data.sessions[0][key] = event_data.session_data[key];
        }
      }
        
      // Send data to Firestore 
      if(data.enable_logs){log('👉 Payload to send: ', firestore_data);}

      Firestore.write(document_path, firestore_data, {projectId: projectId, merge: true})
        .then(() => {
          if(data.enable_logs){log('🟢 User successfully created in Firestore, session successfully added into Firestore');}
        });
      
      // Add user parameters to Big Query        
      for (let key in firestore_data) {
        if (firestore_data.hasOwnProperty(key) && key !== 'sessions') {
          event_data.user_data[key] = firestore_data[key];
        }
      }
      
      Object.delete(event_data.user_data, 'client_id');
            
      // Add session parameters to Big Query 
      event_data.session_data = firestore_data.sessions[0];

      Object.delete(event_data.session_data, 'session_id');

    // If user exists in Firestore  
    } else {
      if(data.enable_logs){log('SEND EVENT DATA TO GOOGLE FIRESTORE...');}          
      if(data.enable_logs){log('👉 User exist');}
      
      const firestore_data = documents[0].data;  
      const sessions_data = firestore_data.sessions;
      const last_session = sessions_data.slice(-1)[0];
                
      // Update user values in Firestore from current user data if not already exists or has a not null value        
      const protected_keys = [
        "user_date", 
        "user_channel_grouping", 
        "user_source", 
        "user_tld_source", 
        "user_campaign", 
        "user_campaign_id", 
        "user_device_type", 
        "user_country", 
        "user_language",
        "user_first_session_timestamp",
        "user_last_session_timestamp"
      ];
        
      Object.keys(event_data.user_data).forEach(function(key) {
        const value = event_data.user_data[key];
          
        if (value == null) {return;}
        if (protected_keys.indexOf(key) !== -1 && firestore_data[key] != null) {return;}
        
        if (firestore_data[key] !== value) {
          firestore_data[key] = value;
        }
      });
      
      // Update last session timestamp of the user
      if(event_data.session_id != last_session.session_id) {
        firestore_data.user_last_session_timestamp = event_data.event_timestamp;
      }
      
      // Add user parameters to Big Query        
      for (let key in firestore_data) {
        if (firestore_data.hasOwnProperty(key) && key !== 'sessions') {
          event_data.user_data[key] = firestore_data[key];
        }
      }
      
      Object.delete(event_data.user_data, 'client_id');
                       
      // If session doesn't exists in Firestore
      if (event_data.session_id != last_session.session_id) {  
        if(data.enable_logs){log('👉 Session does not exist');}
          
        // Set new session values for Firestore from current event data
        var new_session = {
          session_date: event_data.event_date,
          session_id: event_data.session_id,
          session_number: last_session.session_number + 1,
          cross_domain_session: (event_data.event_data.cross_domain_id) ? 'Yes' : 'No',
          session_channel_grouping: event_data.event_data.channel_grouping,
          session_source: event_data.event_data.source,
          session_tld_source: event_data.event_data.tld_source,
          session_campaign: event_data.event_data.campaign,
          session_campaign_content: event_data.event_data.campaign_content,
          session_campaign_id: event_data.event_data.campaign_id,
          session_campaign_term: event_data.event_data.campaign_term,
          session_device_type: event_data.event_data.device_type,
          session_country: event_data.event_data.country,
          session_language: event_data.event_data.browser_language,
          session_hostname: event_data.event_data.page_hostname,
          session_browser_name: event_data.event_data.browser_name,
          session_landing_page_category: (event_data.event_data.page_category) ? event_data.event_data.page_category : null,
          session_landing_page_location: event_data.event_data.page_location,
          session_landing_page_title: event_data.event_data.page_title,
          session_exit_page_category: (event_data.event_data.page_category) ? event_data.event_data.page_category : null,          
          session_exit_page_location: event_data.event_data.page_location,
          session_exit_page_title: event_data.event_data.page_title,
          session_start_timestamp: (event_data.event_name == 'page_view') ? event_data.event_timestamp : 'null',
          session_end_timestamp: event_data.event_timestamp
        };
          
        // Add session parameters for Firestore
        for (let key in event_data.session_data) {
          if (event_data.session_data.hasOwnProperty(key)) {
            new_session[key] = event_data.session_data[key];
          }
        }
          
        // Add new session data to Firestore
        firestore_data.sessions.push(new_session);
        
        // Send data to Firestore                    
        if(data.enable_logs){log('👉 Payload to send: ', firestore_data);}

        Firestore.write(document_path, firestore_data, {projectId: projectId, merge: true})
          .then(() => {
            if(data.enable_logs){log('🟢 User already in Firestore, session successfully added into Firestore');}
          });

        // Add data to BigQuery
        event_data.session_data = firestore_data.sessions.slice(-1)[0];
        Object.delete(event_data.session_data, 'session_id');
        
      // If session exists in Firestore        
      } else {
        if(data.enable_logs){log('👉 Session exist');}       

        // Update session values in Firestore from current session data if not already exists or has a not null value 
        const protected_keys = [
          "session_date", 
          "session_number", 
          "cross_domain_session", 
          "session_channel_grouping", 
          "session_source", 
          "session_tld_source", 
          "session_campaign", 
          "session_campaign_content", 
          "session_campaign_id", 
          "session_campaign_term", 
          "session_device_type", 
          "session_country", 
          "session_language", 
          "session_hostname", 
          "session_browser_name", 
          "session_landing_page_category", 
          "session_landing_page_location", 
          "session_landing_page_title", 
          "session_exit_page_category", 
          "session_exit_page_location", 
          "session_exit_page_title", 
          "session_start_timestamp", 
          "session_end_timestamp"
        ];
        
        Object.keys(event_data.session_data).forEach(function(key) {
          const value = event_data.session_data[key];
          
          if (value == null) {return;}
          if (protected_keys.indexOf(key) !== -1 && last_session[key] != null) {return;}
        
          if (firestore_data[key] !== value) {
            last_session[key] = value;
          }
        });
            
        // Update session values in Firestore from current event data
        last_session.session_exit_page_category = (event_data.event_data.page_category) ? event_data.event_data.page_category : null;
        last_session.session_exit_page_location = event_data.event_data.page_location;
        last_session.session_exit_page_title = event_data.event_data.page_title;
        last_session.session_end_timestamp = event_data.event_timestamp;
        if(last_session.cross_domain_session == 'No'){last_session.cross_domain_session = (event_data.event_data.cross_domain_id) ? 'Yes' : 'No';}
                
        // Send data to firestore                    
        if(data.enable_logs){log('👉 Payload to send: ', firestore_data);}
        
        Firestore.write(document_path, firestore_data, {projectId: projectId, merge: true})
          .then(() => {
            if(data.enable_logs){log('🟢 User already in Firestore, session successfully updated into Firestore');}
          });
        
        // Add data for BigQuery
        event_data.session_data = last_session;
        Object.delete(event_data.session_data, 'session_id');
      }        
    }
    
    return {status: true};
  });
}



// ------------------------------------------------------------------------------------------------------------------------------------------------------



// Send data to Google BigQuery
function send_to_bq(event_data){
  const payload_copy = JSON.parse(JSON.stringify(event_data));
  
  if(data.enable_logs){log('👉 Payload to send: ', payload_copy);}
  
  // Encode data for Google BigQuery        
  encode_data(payload_copy, 'user_data');
  encode_data(payload_copy, 'session_data');
  encode_data(payload_copy, 'event_data');
  encode_data(payload_copy, 'consent_data');
  
  payload_copy.datalayer = (payload_copy.datalayer) ? JSON.stringify(payload_copy.datalayer) : null;
  payload_copy.ecommerce = (payload_copy.ecommerce) ? JSON.stringify(payload_copy.ecommerce) : null;
  
  // Google BigQuery project settings
  const project = {
    projectId: data.bq_project_id,
    datasetId: data.bq_dataset_id,
    tableId: data.bq_table_id
  };
    
  // Write options
  const options = {
    skipInvalidRows: false,
    ignoreUnknownValues: false
  };
  
  // Write to Google BigQuery
  BigQuery.insert(project, [payload_copy], options, 
    () => {if(data.enable_logs){log('🟢 Payload data inserted successfully into BigQuery');}},
    () => {if(data.enable_logs){log('🔴 Payload data not inserted into BigQuery');}}
  );
}



// Encode event data
function encode_data(bq_event_data, prop){
  if(bq_event_data[prop] && Object.keys(bq_event_data[prop]).length > 0){
    var mapped_data = [];
    Object.keys(bq_event_data[prop]).forEach((key) => {
      var temp_data = {};
      // Is string 
      if (getType(bq_event_data[prop][key]) == 'string'){     
        temp_data.name = key;
        temp_data.value = {string: bq_event_data[prop][key] || null};
      // Is number (integer or float)    
      } else if (getType(bq_event_data[prop][key]) == 'number'){
        if(bq_event_data[prop][key] % 1 != 0){
          temp_data.name = key;
          temp_data.value = {float: bq_event_data[prop][key]};
        } else {
          temp_data.name = key;
          temp_data.value = {int: bq_event_data[prop][key]};
        }
      // Is JSON (object or array) 
      } else if (getType(bq_event_data[prop][key]) == 'object' || getType(bq_event_data[prop][key]) == 'array') {
        temp_data.name = key;
        temp_data.value = {json: JSON.stringify(bq_event_data[prop][key])};
                
      // Is null or undefined
      } else if (getType(bq_event_data[prop][key]) == 'null' || getType(bq_event_data[prop][key]) == 'undefined'){
        temp_data.name = key;
        temp_data.value = null;
      // Is boolean        
      } else if (getType(bq_event_data[prop][key]) == 'boolean'){
        temp_data.name = key;
        temp_data.value = {bool: bq_event_data[prop][key]};
      }
      mapped_data.push(temp_data);
    });
    bq_event_data[prop] = mapped_data;
  }
}



// ------------------------------------------------------------------------------------------------------------------------------------------------------



// Send data to custom endpoint 
function send_to_custom_endpoint(custom_request_endpoint_path, event_data) {
  if(data.enable_logs){log('👉 Payload to send: ', event_data);}
  
  const request_options = {
    method: 'POST',
    headers: {}
  };
  
  if (data.add_custom_request_headers) {
    const custom_request_headers = data.custom_request_headers;
    
    if (custom_request_headers !== undefined) {
      for (let i = 0; i < custom_request_headers.length; i++) {
        const header_name = custom_request_headers[i].header_name;
        const header_value = custom_request_headers[i].header_value;
        
        request_options.headers[header_name] = header_value;
      }
    }
  }
  
  sendHttpRequest(custom_request_endpoint_path, request_options, JSON.stringify(event_data))
    .then((result) => {
      if (result.statusCode >= 200 && result.statusCode < 300) {
        if(data.enable_logs){log('🟢 Request send succesfully to:', custom_request_endpoint_path);}
      } else {
        if(data.enable_logs){log('🔴 Request do not send succesfully. Error:', result);}      
      }
    });
}



// ------------------------------------------------------------------------------------------------------------------------------------------------------



// Set user cookie
function set_user_cookie(cookie_name, cookie_value){  
  const cookie_domain = '.' + computeEffectiveTldPlusOne(request_origin);
  const cookie_path = '/';
  const cookie_secure = true;
  const sameSite = "Lax";
  const user_max_age = 400 * 24 * 60 * 60;
  const httpOnly = true;
  
  const cookie_options = {
    domain: cookie_domain, 
    path: cookie_path,
    secure: cookie_secure,
    sameSite: sameSite,
    'max-age': user_max_age,
    httpOnly: httpOnly
  };
      
  setCookie(cookie_name, cookie_value, cookie_options);
}


// Set session cookie
function set_session_cookie(cookie_name, cookie_value){    
  const cookie_domain = '.' + computeEffectiveTldPlusOne(request_origin);
  const cookie_path = '/';
  const cookie_secure = true;
  const sameSite = "Lax";
  const session_max_age = (makeNumber(data.session_max_age) || 30) * 60;
  const httpOnly = true;

  const cookie_options = {
    domain: cookie_domain, 
    path: cookie_path,
    secure: cookie_secure,
    sameSite: sameSite,
    'max-age': session_max_age,
    httpOnly: httpOnly
  };
      
  setCookie(cookie_name, cookie_value, cookie_options);
}


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "read_request",
        "versionId": "1"
      },
      "param": [
        {
          "key": "requestAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "headerAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queryParameterAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "return_response",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "run_container",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_response",
        "versionId": "1"
      },
      "param": [
        {
          "key": "writeResponseAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "writeHeaderAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_bigquery",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedTables",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "projectId"
                  },
                  {
                    "type": 1,
                    "string": "datasetId"
                  },
                  {
                    "type": 1,
                    "string": "tableId"
                  },
                  {
                    "type": 1,
                    "string": "operation"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_container_data",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "set_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedCookies",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_firestore",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedOptions",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "projectId"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "operation"
                  },
                  {
                    "type": 1,
                    "string": "databaseId"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "read_write"
                  },
                  {
                    "type": 1,
                    "string": "(default)"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []
setup: ''


___NOTES___

Created on 25/09/2025, 13:54:44


